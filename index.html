<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Control Personal</title>
    
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#2563eb">

    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9IjEyMCIgZmlsbD0iIzI1NjNlYiIvPjxwYXRoIGQ9Ik0xMjggMTc2djE2MGMwIDE3LjcgMTQuMyAzMiAzMiAzMmgxOTJjMTcuNyAwIDMyLTE0LjMgMzItMzJ2LTE2MGMwLTE3LjctMTQuMy0zMi0zMi0zMkgxNjBjLTE3LjcgMC0zMiAxNC4zLTMyIDMyem0zMi0xMGgxOTJjNS41IDAgMTAgNC41IDEwIDEwdjE2MGMwIDUuNS00LjUiMTAtMTAgMTBIMTYwYy01LjUgMC0xMC00LjUtMTAtMTBWMTc2YzAtNS41IDQuNS0xMCAxMC0xMHoiIGZpbGw9IndoaXRlIi8+PHBhdGggZD0iTTMyMCAyNTZoMzJ2MzJoLTMyeiIgZmlsbD0id2hpdGUiLz48cGF0aCBkPSJNMTQwIDE0MGgyMzIiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMzAiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPjwvc3ZnPg==">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9IjEyMCIgZmlsbD0iIzI1NjNlYiIvPjxwYXRoIGQ9Ik0xMjggMTc2djE2MGMwIDE3LjcgMTQuMyAzMiAzMiAzMmgxOTJjMTcuNyAwIDMyLTE0LjMgMzItMzJ2LTE2MGMwLTE3LjctMTQuMy0zMi0zMi0zMkgxNjBjLTE3LjcgMC0zMiAxNC4zLTMyIDMyem0zMi0xMGgxOTJjNS41IDAgMTAgNC41IDEwIDEwdjE2MGMwIDUuNS00LjUiMTAtMTAgMTBIMTYwYy01LjUgMC0xMC00LjUtMTAtMTBWMTc2YzAtNS41IDQuNS0xMCAxMC0xMHoiIGZpbGw9IndoaXRlIi8+PHBhdGggZD0iTTMyMCAyNTZoMzJ2MzJoLTMyeiIgZmlsbD0id2hpdGUiLz48cGF0aCBkPSJNMTQwIDE0MGgyMzIiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMzAiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPjwvc3ZnPg==">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { colors: { slate: { 850: '#1e293b', 900: '#0f172a' } }, fontFamily: { sans: ['system-ui', '-apple-system', 'sans-serif'] } } }
        }
    </script>
    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        body { -webkit-tap-highlight-color: transparent; user-select: none; overscroll-behavior-y: none; }
        input { user-select: text; }
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
        #loading-screen { position: fixed; inset: 0; background: #0f172a; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; z-index: 9999; transition: opacity 0.5s; }
    </style>
</head>
<body class="bg-slate-100 dark:bg-slate-950 text-slate-800 h-screen overflow-hidden select-none transition-colors duration-300">
    
    <div id="loading-screen">
        <div class="text-4xl mb-4">üìÇ</div>
        <h2 class="text-xl font-bold">Control Personal</h2>
        <p class="text-sm text-slate-400 mt-2">Cargando Sistema...</p>
    </div>

    <div id="root" class="h-full overflow-y-auto scrollbar-hide"></div>

    <script>
        window.onerror = function(msg, url, line) {
            const loader = document.getElementById('loading-screen');
            if(loader) {
                loader.innerHTML = `<div style="padding:20px;text-align:center;color:#ff6b6b;"><h3>‚ö†Ô∏è Error</h3><p>${msg}</p></div>`;
            }
        };
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js').catch(err => console.log('SW fail', err)); });
        }
    </script>

    <script type="module">
        import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            Wallet, Plus, X, ChevronRight, Lock, LogOut, 
            LayoutGrid, PieChart as PieIcon, Settings, Trash2, 
            ShoppingBag, Coffee, Car, Home, Zap, Heart, Briefcase, 
            Smartphone, Plane, Gift, Music, Book, Smile, Star, 
            TrendingUp, TrendingDown, Target, Sun, Moon, User, 
            RefreshCcw, UserCircle2, Palette, Check, AlertTriangle,
            Clock, ShieldCheck, Ban, FileText, Download, Calendar, FileSpreadsheet
        } from 'https://esm.sh/lucide-react@0.263.1';

        setTimeout(() => {
            const loader = document.getElementById('loading-screen');
            if(loader) { loader.style.opacity = '0'; setTimeout(() => loader.remove(), 500); }
        }, 1000);

        const ICON_MAP = { ShoppingBag, Coffee, Car, Home, Zap, Heart, Briefcase, Smartphone, Plane, Gift, Music, Book, Smile, Star, Target, User, Wallet, FileText };
        
        const THEME_COLORS = {
            blue:   { name: 'Azul',   bg: 'bg-blue-600',   text: 'text-blue-600',   ring: 'ring-blue-400' },
            indigo: { name: '√çndigo', bg: 'bg-indigo-500', text: 'text-indigo-500', ring: 'ring-indigo-400' },
            emerald:{ name: 'Verde',  bg: 'bg-emerald-600',text: 'text-emerald-600',ring: 'ring-emerald-400' },
            orange: { name: 'Naranja',bg: 'bg-orange-500', text: 'text-orange-500', ring: 'ring-orange-400' },
            rose:   { name: 'Rosa',   bg: 'bg-rose-500',   text: 'text-rose-500',   ring: 'ring-rose-400' },
            slate:  { name: 'Negro',  bg: 'bg-slate-700',  text: 'text-slate-700',  ring: 'ring-slate-400' },
        };

        const DEFAULT_CATS = [
            { id: 'c1', name: 'Comida', icon: 'Coffee', color: '#F59E0B' },
            { id: 'c2', name: 'Transporte', icon: 'Car', color: '#3B82F6' },
            { id: 'c3', name: 'Casa', icon: 'Home', color: '#10B981' },
            { id: 'c4', name: 'Ocio', icon: 'Smile', color: '#EC4899' },
        ];

        const safeLoad = (key, fallback) => {
            try { const item = localStorage.getItem(key); return item ? JSON.parse(item) : fallback; } catch (e) { return fallback; }
        };
        const formatCordoba = (amount) => new Intl.NumberFormat('es-NI', { style: 'currency', currency: 'NIO', maximumFractionDigits: 0 }).format(amount);
        const formatDate = (isoString) => { 
            if (!isoString) return ''; 
            const date = new Date(isoString); 
            return date.toLocaleDateString('es-NI', { day: 'numeric', month: 'short', hour: '2-digit', minute:'2-digit' }); 
        };
        const getNowInput = () => { const now = new Date(); now.setMinutes(now.getMinutes() - now.getTimezoneOffset()); return now.toISOString().slice(0, 16); };


        const Card = ({ children, className = "", onClick }) => React.createElement('div', { onClick, className: `bg-white dark:bg-slate-850 p-5 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm ${className}` }, children);
        const IconRenderer = ({ name, size = 20, className }) => { const Icon = ICON_MAP[name] || Star; return React.createElement(Icon, { size, className }); };

        // --- FUNCIONES DE REPORTE ---
        const generatePDF = (data, profileName, rangeName, categories) => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFontSize(20); doc.setTextColor(37, 99, 235); doc.text("Reporte Financiero", 14, 20);
            doc.setFontSize(10); doc.setTextColor(100); doc.text(`Generado por: Control Personal (${profileName})`, 14, 28); doc.text(`Periodo: ${rangeName}`, 14, 33); doc.text(`Fecha: ${new Date().toLocaleDateString()}`, 14, 38);

            const income = data.filter(t => t.type === 'income').reduce((a,b) => a + Number(b.amount), 0);
            const expense = data.filter(t => t.type === 'expense').reduce((a,b) => a + Number(b.amount), 0);
            const balance = income - expense;

            doc.autoTable({ startY: 45, head: [['Resumen', 'Monto (C$)']], body: [['Total Ingresos', formatCordoba(income)], ['Total Gastos', formatCordoba(expense)], ['Balance Final', formatCordoba(balance)]], theme: 'grid', headStyles: { fillColor: [37, 99, 235] } });
            const rows = data.map(t => { const cat = categories.find(c => c.id === t.categoryId) || { name: 'General' }; return [formatDate(t.date), cat.name, t.description, t.type === 'income' ? 'Ingreso' : 'Gasto', formatCordoba(t.amount)]; });
            doc.text("Detalle de Movimientos", 14, doc.lastAutoTable.finalY + 10);
            doc.autoTable({ startY: doc.lastAutoTable.finalY + 15, head: [['Fecha', 'Categor√≠a', 'Nota', 'Tipo', 'Monto']], body: rows, theme: 'striped', styles: { fontSize: 8 }, headStyles: { fillColor: [30, 41, 59] } });
            doc.save(`Reporte_${profileName}_${rangeName}.pdf`);
        };

        const generateExcel = (data, profileName, rangeName, categories) => {
            const rows = data.map(t => { const cat = categories.find(c => c.id === t.categoryId) || { name: 'General' }; return { Fecha: formatDate(t.date), Hora: new Date(t.date).toLocaleTimeString(), Categoria: cat.name, Descripcion: t.description, Tipo: t.type === 'income' ? 'Ingreso' : 'Gasto', Monto: t.amount }; });
            const ws = XLSX.utils.json_to_sheet(rows); const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Movimientos"); XLSX.writeFile(wb, `Reporte_${profileName}.xlsx`);
        };

        function App() {
            const [config, setConfig] = useState(() => safeLoad('ew_ctrl_config', null));
            const [darkMode, setDarkMode] = useState(() => safeLoad('ew_dark_mode', true));
            const [isAuth, setIsAuth] = useState(false);
            const [pinInput, setPinInput] = useState('');
            const [errorMsg, setErrorMsg] = useState('');
            const [newUserName, setNewUserName] = useState('');
            const [newUserPin, setNewUserPin] = useState('');
            const [newUserPinConfirm, setNewUserPinConfirm] = useState('');
            const [transactions, setTransactions] = useState(() => safeLoad('ew_ctrl_trans', []));
            const [categories, setCategories] = useState(() => safeLoad('ew_ctrl_cats', DEFAULT_CATS));
            const [goals, setGoals] = useState(() => safeLoad('ew_ctrl_goals', []));
            const [walletMode, setWalletMode] = useState('personal');
            const [activeTab, setActiveTab] = useState('home');
            
            const [showTransModal, setShowTransModal] = useState(false);
            const [showCatModal, setShowCatModal] = useState(false);
            const [showCreateCat, setShowCreateCat] = useState(false);
            const [showGoalModal, setShowGoalModal] = useState(false);
            const [showNameEdit, setShowNameEdit] = useState(false);
            const [showResetConfirm, setShowResetConfirm] = useState(false);
            const [showReportModal, setShowReportModal] = useState(false);
            const [formError, setFormError] = useState('');
            const [tempName, setTempName] = useState('');
            const [reportFilter, setReportFilter] = useState('month');
            const [customStart, setCustomStart] = useState('');
            const [customEnd, setCustomEnd] = useState('');
            
            const [transForm, setTransForm] = useState({ amount: '', desc: '', type: 'expense', categoryId: null, date: getNowInput() });
            const [catForm, setCatForm] = useState({ name: '', icon: 'Star', color: '#6366f1' });
            const [goalForm, setGoalForm] = useState({ name: '', target: '' });

            // --- ¬°NUEVO ESTADO PARA EDITAR! ---
            const [editingTx, setEditingTx] = useState(null); // Guarda la Tx que se est√° editando

            useEffect(() => localStorage.setItem('ew_ctrl_trans', JSON.stringify(transactions)), [transactions]);
            useEffect(() => localStorage.setItem('ew_ctrl_cats', JSON.stringify(categories)), [categories]);
            useEffect(() => localStorage.setItem('ew_ctrl_goals', JSON.stringify(goals)), [goals]);
            useEffect(() => { if (config) localStorage.setItem('ew_ctrl_config', JSON.stringify(config)); }, [config]);
            useEffect(() => { localStorage.setItem('ew_dark_mode', JSON.stringify(darkMode)); }, [darkMode]);
            
            useEffect(() => {
                if (config) {
                    let fixed = false;
                    const newConfig = { ...config };
                    if (!newConfig.personal) { newConfig.personal = { name: 'M√≠o', theme: 'blue', gender: 'male' }; fixed = true; }
                    if (!newConfig.partner) { newConfig.partner = { name: 'Pareja', theme: 'rose', gender: 'female' }; fixed = true; }
                    if (fixed) setConfig(newConfig);
                }
            }, [config]);

            const safeConfig = config || { personal: { name: 'Usuario' }, partner: { name: 'Pareja' } };
            const currentProfile = safeConfig[walletMode] || (walletMode === 'personal' ? { name: 'M√≠o', theme: 'blue' } : { name: 'Pareja', theme: 'rose' });
            const theme = THEME_COLORS[currentProfile.theme] || THEME_COLORS.blue;

            const updateProfile = (updates) => { if (!config) return; setConfig(prev => ({ ...prev, [walletMode]: { ...prev[walletMode], ...updates } })); };
            
            const currentData = transactions.filter(t => t.walletMode === walletMode);
            const currentGoals = goals.filter(g => g.walletMode === walletMode);
            const income = currentData.filter(t => t.type === 'income').reduce((acc, t) => acc + (Number(t.amount) || 0), 0);
            const expense = currentData.filter(t => t.type === 'expense').reduce((acc, t) => acc + (Number(t.amount) || 0), 0);
            const balance = income - expense;
            const sortedData = [...currentData].sort((a, b) => new Date(b.date) - new Date(a.date));

            const getFilteredDataForReport = () => {
                const now = new Date();
                let filtered = currentData;
                if (reportFilter === 'month') { filtered = currentData.filter(t => { const d = new Date(t.date); return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear(); }); }
                else if (reportFilter === 'prev_month') { const prevMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1); filtered = currentData.filter(t => { const d = new Date(t.date); return d.getMonth() === prevMonth.getMonth() && d.getFullYear() === prevMonth.getFullYear(); }); }
                else if (reportFilter === 'custom' && customStart && customEnd) { filtered = currentData.filter(t => { const d = new Date(t.date); return d >= new Date(customStart) && d <= new Date(customEnd); }); }
                return filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
            };

            const handleFinishSetup = () => {
                if (!newUserName.trim() || newUserPin.length < 4) return;
                if (newUserPin !== newUserPinConfirm) { setErrorMsg('PINs no coinciden'); return; }
                const newConfig = { pin: newUserPin, personal: { name: newUserName, theme: 'blue', gender: 'male' }, partner: { name: 'Pareja', theme: 'rose', gender: 'female' } };
                setConfig(newConfig);
                localStorage.setItem('ew_ctrl_config', JSON.stringify(newConfig));
                setIsAuth(true);
            };

            const handleLogin = (e) => { e.preventDefault(); if (pinInput === config.pin) { setIsAuth(true); setErrorMsg(''); } else setErrorMsg('PIN Incorrecto'); };
            
            // --- ¬°FUNCIONES MODIFICADAS Y NUEVAS! ---

            // Nueva funci√≥n para limpiar el formulario
            const resetTransForm = () => {
                setTransForm({ amount: '', desc: '', type: 'expense', categoryId: null, date: getNowInput() });
                setEditingTx(null);
                setFormError('');
            };

            // Nueva funci√≥n para abrir el modal para un NUEVO movimiento
            const handleOpenNewTx = (type = 'expense') => {
                resetTransForm();
                setTransForm(prev => ({ ...prev, type }));
                setShowTransModal(true);
            };

            // Nueva funci√≥n para abrir el modal para EDITAR un movimiento
            const handleStartEdit = (tx) => {
                setFormError('');
                setEditingTx(tx);
                setTransForm({
                    amount: tx.amount,
                    desc: tx.description,
                    type: tx.type,
                    categoryId: tx.categoryId,
                    date: tx.date.slice(0, 16) // Ajustar formato para datetime-local
                });
                setShowTransModal(true);
            };

            // Nueva funci√≥n para BORRAR un movimiento
            const handleDeleteTrans = () => {
                if (!editingTx) return;
                setTransactions(transactions.filter(t => t.id !== editingTx.id));
                setShowTransModal(false);
                resetTransForm();
            };

            // ¬°MODIFICADA! Ahora se llama 'handleSaveTrans' y maneja AMBOS casos
            const handleSaveTrans = () => {
                setFormError('');
                const amount = Number(transForm.amount);
                if (!amount || amount <= 0) { setFormError('Monto inv√°lido'); return; }
                if (!transForm.categoryId) { setFormError('Elige categor√≠a'); return; }
                
                if (editingTx) {
                    // --- L√ìGICA DE ACTUALIZACI√ìN ---
                    const originalAmount = Number(editingTx.amount) || 0;
                    const originalType = editingTx.type;
                    let incomeChange = 0;
                    let expenseChange = 0;

                    if (originalType === 'income') incomeChange -= originalAmount;
                    else expenseChange -= originalAmount;
                    
                    if (transForm.type === 'income') incomeChange += amount;
                    else expenseChange += amount;
                    
                    if ((expense + expenseChange) > (income + incomeChange)) {
                        setFormError('Fondos insuficientes'); return;
                    }
                    
                    const updatedTx = { ...editingTx, 
                        amount: Number(amount), 
                        description: transForm.desc || '', 
                        type: transForm.type, 
                        categoryId: transForm.categoryId, 
                        date: transForm.date || new Date().toISOString() 
                    };
                    setTransactions(transactions.map(t => t.id === editingTx.id ? updatedTx : t));

                } else {
                    // --- L√ìGICA DE CREACI√ìN (la que ya ten√≠as) ---
                    if (transForm.type === 'expense' && amount > balance) { setFormError('Fondos insuficientes'); return; }
                    const newTx = { 
                        id: Date.now().toString(), // Usar string para IDs es m√°s seguro
                        walletMode, 
                        amount: Number(amount), 
                        description: transForm.desc || '', 
                        type: transForm.type, 
                        categoryId: transForm.categoryId, 
                        date: transForm.date || new Date().toISOString() 
                    };
                    setTransactions([newTx, ...transactions]);
                }
                
                setShowTransModal(false);
                resetTransForm();
            };

            // -------------------------------------------------

            const handleResetProfileData = () => {
                const otherTrans = transactions.filter(t => t.walletMode !== walletMode);
                const otherGoals = goals.filter(g => g.walletMode !== walletMode);
                setTransactions(otherTrans);
                setGoals(otherGoals);
                updateProfile({ theme: walletMode === 'personal' ? 'blue' : 'rose', gender: walletMode === 'personal' ? 'male' : 'female' });
                setShowResetConfirm(false);
            };

            return React.createElement("div", { className: darkMode ? "dark" : "" },
                React.createElement("div", { className: "min-h-screen bg-gradient-to-b from-slate-100 to-slate-200 dark:from-slate-900 dark:to-black text-slate-800 dark:text-slate-200 font-sans pb-24 transition-colors duration-300" },

                    /* SETUP (Sin cambios) */
                    !config && React.createElement("div", { className: "min-h-screen flex items-center justify-center p-6 fade-in relative" },
                        React.createElement("button", { onClick: () => setDarkMode(!darkMode), className: "absolute top-6 right-6 p-3 rounded-full bg-white dark:bg-slate-800 shadow-lg border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-200 z-50 active:scale-90 transition-transform" }, darkMode ? React.createElement(Sun, { size: 24 }) : React.createElement(Moon, { size: 24 })),
                        React.createElement("div", { className: "w-full max-w-sm bg-white dark:bg-slate-800/90 backdrop-blur-md rounded-[2rem] p-8 shadow-2xl border border-white/50 dark:border-slate-700" },
                            React.createElement("div", { className: "flex justify-center mb-6" }, React.createElement("div", { className: "bg-blue-600 p-4 rounded-2xl shadow-blue-500/30 shadow-lg" }, React.createElement(ShieldCheck, { className: "text-white", size: 40 }))),
                            React.createElement("h2", { className: "text-2xl font-bold text-center mb-2 text-slate-900 dark:text-white" }, "Crear Cuenta"),
                            React.createElement("div", { className: "space-y-5" },
                                React.createElement("input", { className: "w-full p-4 bg-slate-50 dark:bg-slate-900 border-2 border-slate-200 dark:border-slate-700 rounded-xl font-bold outline-none focus:border-blue-500 dark:focus:border-blue-500 text-slate-900 dark:text-white", placeholder: "Tu Nombre", value: newUserName, onChange: e => setNewUserName(e.target.value) }),
                                React.createElement("input", { type: "password", maxLength: 4, inputMode: "numeric", className: "w-full p-4 bg-slate-50 dark:bg-slate-900 border-2 border-slate-200 dark:border-slate-700 rounded-xl font-bold outline-none focus:border-blue-500 dark:focus:border-blue-500 text-slate-900 dark:text-white text-center", placeholder: "PIN (4 d√≠gitos)", value: newUserPin, onChange: e => setNewUserPin(e.target.value) }),
                                React.createElement("input", { type: "password", maxLength: 4, inputMode: "numeric", className: "w-full p-4 bg-slate-50 dark:bg-slate-900 border-2 border-slate-200 dark:border-slate-700 rounded-xl font-bold outline-none focus:border-blue-500 dark:focus:border-blue-500 text-slate-900 dark:text-white text-center", placeholder: "Confirmar PIN", value: newUserPinConfirm, onChange: e => setNewUserPinConfirm(e.target.value) }),
                                React.createElement("button", { onClick: handleFinishSetup, disabled: !newUserName || newUserPin.length < 4 || newUserPin !== newUserPinConfirm, className: "w-full bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 transition-all" }, "Guardar")
                            )
                        )
                    ),

                    /* LOGIN (Sin cambios) */
                    config && !isAuth && React.createElement("div", { className: "min-h-screen flex items-center justify-center p-6 fade-in relative" },
                        React.createElement("button", { onClick: () => setDarkMode(!darkMode), className: "absolute top-6 right-6 p-3 rounded-full bg-white dark:bg-slate-800 shadow-lg border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-200 z-50 active:scale-90 transition-transform" }, darkMode ? React.createElement(Sun, { size: 24 }) : React.createElement(Moon, { size: 24 })),
                        React.createElement("div", { className: "w-full max-w-sm bg-white dark:bg-slate-800/95 backdrop-blur-md rounded-[2rem] p-8 shadow-2xl border border-white/50 dark:border-slate-700" },
                            React.createElement("div", { className: "flex justify-center mb-6" }, React.createElement("div", { className: "bg-slate-100 dark:bg-slate-700 p-4 rounded-2xl shadow-inner" }, React.createElement(Lock, { className: "text-slate-600 dark:text-slate-300", size: 32 }))),
                            React.createElement("h2", { className: "text-2xl font-bold text-center text-slate-800 dark:text-white mb-1" }, "Hola, ", safeConfig.personal?.name || 'Usuario'),
                            React.createElement("form", { onSubmit: handleLogin, className: "space-y-6 mt-8" },
                                React.createElement("input", { type: "password", maxLength: 4, inputMode: "numeric", className: "w-full bg-slate-50 dark:bg-slate-950 border-2 border-slate-200 dark:border-slate-700 rounded-2xl py-5 text-center text-3xl font-bold tracking-[1em] text-slate-800 dark:text-white focus:border-blue-500 outline-none shadow-sm", placeholder: "‚Ä¢‚Ä¢‚Ä¢‚Ä¢", value: pinInput, onChange: (e) => setPinInput(e.target.value) }),
                                errorMsg && React.createElement("p", { className: "text-rose-500 text-xs text-center font-bold bg-rose-50 dark:bg-rose-900/20 p-2 rounded-lg" }, errorMsg),
                                React.createElement("button", { className: "w-full bg-slate-900 dark:bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 transition-transform" }, "Entrar")
                            )
                        )
                    ),

                    /* APP */
                    config && isAuth && React.createElement(React.Fragment, null,
                        React.createElement("header", { className: `${theme.bg} pt-8 pb-20 px-6 rounded-b-[2.5rem] shadow-lg relative overflow-hidden transition-colors duration-500` },
                           /* ... (Sin cambios) ... */
                           React.createElement("div", { className: "relative z-10 flex justify-center mb-6" },
                                React.createElement("div", { className: "bg-black/20 p-1 rounded-full flex backdrop-blur-sm" },
                                    React.createElement("button", { onClick: () => setWalletMode('personal'), className: `px-4 py-2 rounded-full text-xs font-bold flex items-center gap-2 transition-all ${walletMode === 'personal' ? 'bg-white text-slate-800 shadow-sm' : 'text-white/70'}` }, React.createElement(User, { size: 14 }), safeConfig.personal?.name || 'M√≠o'),
                                    React.createElement("button", { onClick: () => setWalletMode('partner'), className: `px-4 py-2 rounded-full text-xs font-bold flex items-center gap-2 transition-all ${walletMode === 'partner' ? 'bg-white text-slate-800 shadow-sm' : 'text-white/70'}` }, React.createElement(Heart, { size: 14 }), safeConfig.partner?.name || 'Pareja')
                                )
                            ),
                            React.createElement("div", { className: "relative z-10 text-center text-white" },
                                React.createElement("span", { className: "text-white/80 text-xs font-medium uppercase tracking-wider" }, "Saldo Disponible"),
                                React.createElement("h1", { className: "text-5xl font-bold tracking-tight mt-1 mb-6" }, formatCordoba(balance)),
                                React.createElement("div", { className: "flex justify-center gap-3" },
                                    React.createElement("div", { className: "bg-white/10 backdrop-blur-sm px-4 py-2 rounded-xl flex items-center gap-2 border border-white/5" }, React.createElement(TrendingUp, { size: 14, className: "text-emerald-200" }), React.createElement("span", { className: "font-bold text-sm" }, "+", formatCordoba(income))),
                                    React.createElement("div", { className: "bg-white/10 backdrop-blur-sm px-4 py-2 rounded-xl flex items-center gap-2 border border-white/5" }, React.createElement(TrendingDown, { size: 14, className: "text-rose-200" }), React.createElement("span", { className: "font-bold text-sm" }, "-", formatCordoba(expense)))
                                )
                            )
                        ),

                        React.createElement("main", { className: "px-5 -mt-10 relative z-20 space-y-6 pb-24 fade-in" },
                            activeTab === 'home' && React.createElement(React.Fragment, null,
                                React.createElement("div", { className: "grid grid-cols-2 gap-4" },
                                    // --- MODIFICADO ---
                                    React.createElement("button", { onClick: () => handleOpenNewTx('income'), className: "bg-white dark:bg-slate-850 p-4 rounded-2xl shadow-sm flex items-center gap-3 active:scale-95 transition-transform border border-slate-100 dark:border-slate-800" }, React.createElement("div", { className: "bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400 p-3 rounded-full" }, React.createElement(TrendingUp, { size: 20 })), React.createElement("div", { className: "text-left" }, React.createElement("span", { className: "block font-bold text-sm text-slate-700 dark:text-white" }, "Ingreso"))),
                                    // --- MODIFICADO ---
                                    React.createElement("button", { onClick: () => handleOpenNewTx('expense'), className: "bg-white dark:bg-slate-850 p-4 rounded-2xl shadow-sm flex items-center gap-3 active:scale-95 transition-transform border border-slate-100 dark:border-slate-800" }, React.createElement("div", { className: "bg-rose-50 dark:bg-rose-900/20 text-rose-500 dark:text-rose-400 p-3 rounded-full" }, React.createElement(TrendingDown, { size: 20 })), React.createElement("div", { className: "text-left" }, React.createElement("span", { className: "block font-bold text-sm text-slate-700 dark:text-white" }, "Gasto")))
                                ),
                                React.createElement("div", null,
                                    React.createElement("h3", { className: "font-bold text-slate-500 dark:text-slate-500 text-xs uppercase tracking-wider mb-3 ml-1" }, "Movimientos"),
                                    React.createElement("div", { className: "space-y-3" },
                                        // --- MODIFICADO (se a√±ade onClick) ---
                                        sortedData.slice(0, 15).map(t => {
                                            const cat = categories.find(c => c.id === t.categoryId) || DEFAULT_CATS[0];
                                            return React.createElement(Card, { 
                                                key: t.id, 
                                                onClick: () => handleStartEdit(t), // <-- ¬°CLIC PARA EDITAR!
                                                className: "!p-3 flex justify-between items-center hover:bg-slate-50 dark:hover:bg-slate-800/50 cursor-pointer active:scale-[0.98]" 
                                            },
                                                React.createElement("div", { className: "flex items-center gap-4" },
                                                    React.createElement("div", { style: { backgroundColor: `${cat.color}15`, color: cat.color }, className: "w-12 h-12 rounded-2xl flex items-center justify-center" }, React.createElement(IconRenderer, { name: cat.icon })),
                                                    React.createElement("div", { className: "min-w-0" }, 
                                                        React.createElement("p", { className: "font-bold text-sm text-slate-700 dark:text-white" }, cat.name), 
                                                        React.createElement("div", { className: "flex items-center gap-2 text-xs text-slate-400 dark:text-slate-500" }, 
                                                            React.createElement("span", { className: "whitespace-nowrap" }, formatDate(t.date)), 
                                                            t.description && React.createElement("span", { className: "truncate max-w-[80px]" }, "‚Ä¢ ", t.description)
                                                        )
                                                    )
                                                ),
                                                React.createElement("div", { className: "text-right" }, React.createElement("span", { className: `font-bold text-sm block ${t.type === 'income' ? 'text-emerald-500' : 'text-slate-700 dark:text-slate-300'}` }, t.type === 'income' ? '+' : '-', formatCordoba(t.amount)))
                                            );
                                        })
                                    )
                                )
                            ),
                            
                            /* Pesta√±as Goals, Stats, Profile (Sin cambios por ahora) */
                            activeTab === 'goals' && React.createElement("div", { className: "space-y-4 fade-in" },
                                React.createElement("div", { className: "flex justify-between items-center px-1" }, React.createElement("h3", { className: "font-bold text-slate-700 dark:text-slate-200" }, "Mis Metas"), React.createElement("button", { onClick: () => setShowGoalModal(true), className: `text-xs font-bold px-4 py-2 rounded-lg ${theme.bg} text-white shadow-sm` }, "+ Nueva")),
                                currentGoals.map(g => {
                                    const percent = Math.min(100, Math.round((g.current / g.target) * 100));
                                    return React.createElement(Card, { key: g.id, className: "relative overflow-hidden border-l-4 border-slate-200 dark:border-slate-800", style: { borderLeftColor: g.color } },
                                        React.createElement("div", { className: "flex justify-between items-end mb-3 relative z-10" },
                                            React.createElement("div", null, React.createElement("h4", { className: "font-bold text-lg text-slate-800 dark:text-white" }, g.name), React.createElement("p", { className: "text-xs text-slate-500 dark:text-slate-400" }, "Meta: ", formatCordoba(g.target))),
                                            React.createElement("div", { className: "text-right" }, React.createElement("span", { className: "text-xl font-bold text-slate-800 dark:text-white" }, formatCordoba(g.current)), React.createElement("span", { className: "block text-[10px] font-bold text-slate-400 uppercase" }, percent, "% logrado"))
                                        ),
                                        React.createElement("div", { className: "w-full bg-slate-100 dark:bg-black h-3 rounded-full overflow-hidden mb-4 relative" }, React.createElement("div", { className: "h-full transition-all duration-700 rounded-full", style: { width: `${percent}%`, backgroundColor: g.color } })),
                                        React.createElement("div", { className: "flex justify-end gap-3 relative z-10 pt-3 border-t border-slate-50 dark:border-slate-800" },
                                            React.createElement("button", { onClick: () => { const input = prompt(`Abonar a ${g.name} (C$):`); const add = Number(input); if (add > 0 && add <= balance) { setGoals(goals.map(x => x.id === g.id ? { ...x, current: x.current + add } : x)); } else if(add>balance) alert("Sin fondos"); }, className: `text-xs font-bold ${theme.text} bg-slate-50 dark:bg-slate-800 px-4 py-2 rounded-lg` }, "Abonar"),
                                            React.createElement("button", { onClick: () => setGoals(goals.filter(x => x.id !== g.id)), className: "p-2 text-slate-400 hover:text-rose-500" }, React.createElement(Trash2, { size: 16 }))
                                        )
                                    );
                                })
                            ),
                            
                            activeTab === 'stats' && React.createElement(Card, { className: "flex flex-col items-center pt-8 pb-8 fade-in" },
                                React.createElement("div", { className: "w-full flex justify-between items-center mb-6" },
                                    React.createElement("h3", { className: "font-bold text-slate-800 dark:text-white" }, "Gastos por Categor√≠a"),
                                    React.createElement("button", { onClick: () => setShowReportModal(true), className: "flex items-center gap-2 bg-slate-100 dark:bg-slate-800 px-3 py-1.5 rounded-lg text-xs font-bold text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors" },
                                        React.createElement(Download, { size: 14 }), "Exportar"
                                    )
                                ),
                                React.createElement("div", { className: "w-full space-y-2" },
                                    expense === 0 ? React.createElement("p", { className: "text-center text-slate-400 text-sm" }, "No hay datos de gastos") :
                                    categories.map(cat => {
                                        const amount = currentData.filter(t => t.type === 'expense' && t.categoryId === cat.id).reduce((sum, t) => sum + Number(t.amount), 0);
                                        if(amount === 0) return null;
                                        return React.createElement("div", { key: cat.id, className: "flex items-center justify-between text-sm p-2 rounded-lg" },
                                            React.createElement("div", { className: "flex items-center gap-3" }, React.createElement("div", { className: "w-3 h-3 rounded-full", style: { backgroundColor: cat.color } }), React.createElement("span", { className: "text-slate-600 dark:text-slate-300" }, cat.name)),
                                            React.createElement("span", { className: "font-bold text-slate-700 dark:text-white" }, formatCordoba(amount))
                                        );
                                    })
                                )
                            ),

                            activeTab === 'profile' && React.createElement("div", { className: "space-y-5 fade-in" },
                                React.createElement(Card, { className: "flex items-center gap-4 bg-slate-800 dark:bg-slate-900 text-white border-none shadow-md" },
                                    React.createElement("div", { className: "w-16 h-16 bg-white/10 rounded-full flex items-center justify-center text-3xl font-bold border-2 border-white/10" }, currentProfile.gender === 'female' ? React.createElement(UserCircle2, { size: 40 }) : React.createElement(User, { size: 40 })),
                                    React.createElement("div", { className: "flex-1" },
                                        React.createElement("div", { className: "flex items-center gap-2" }, React.createElement("h2", { className: "font-bold text-xl" }, currentProfile.name), React.createElement("button", { onClick: () => { setTempName(currentProfile.name); setShowNameEdit(true); }, className: "p-1 bg-white/10 rounded-full hover:bg-white/20 transition-colors" }, React.createElement(Settings, { size: 12 }))),
                                        React.createElement("p", { className: "text-slate-400 text-xs uppercase tracking-wide" }, "ID: ", walletMode === 'personal' ? 'Propietario' : 'Pareja')
                                    )
                                ),
                                React.createElement("div", { className: "bg-white dark:bg-slate-850 rounded-2xl p-5 shadow-sm border border-slate-100 dark:border-slate-800" },
                                    React.createElement("h4", { className: "text-xs font-bold text-slate-400 uppercase mb-3 flex items-center gap-2" }, React.createElement(Palette, { size: 14 }), " Color del Tema"),
                                    React.createElement("div", { className: "flex justify-between gap-2 overflow-x-auto pb-2 scrollbar-hide" }, Object.entries(THEME_COLORS).map(([key, val]) => React.createElement("button", { key, onClick: () => updateProfile({ theme: key }), className: `w-10 h-10 rounded-full flex items-center justify-center transition-all shrink-0 ${val.bg} ${currentProfile.theme === key ? `ring-4 ring-offset-2 ${val.ring} ring-offset-white dark:ring-offset-slate-900 scale-110` : 'opacity-50 hover:opacity-100'}` }, currentProfile.theme === key && React.createElement(Check, { size: 16, className: "text-white" }))))
                                ),
                                React.createElement("div", { className: "bg-white dark:bg-slate-850 rounded-2xl overflow-hidden shadow-sm border border-slate-100 dark:border-slate-800 divide-y divide-slate-100 dark:divide-slate-800" },
                                    React.createElement("div", { className: "p-4 flex items-center justify-between" },
                                        React.createElement("span", { className: "font-medium text-slate-700 dark:text-white text-sm flex items-center gap-3" }, React.createElement(User, { size: 18, className: "text-slate-400" }), " G√©nero"),
                                        React.createElement("div", { className: "flex bg-slate-100 dark:bg-slate-800 p-1 rounded-lg" },
                                            React.createElement("button", { onClick: () => updateProfile({ gender: 'male' }), className: `px-3 py-1 rounded-md text-xs font-bold transition-all ${currentProfile.gender === 'male' ? 'bg-white dark:bg-slate-700 shadow text-blue-500' : 'text-slate-400'}` }, "Hombre"),
                                            React.createElement("button", { onClick: () => updateProfile({ gender: 'female' }), className: `px-3 py-1 rounded-md text-xs font-bold transition-all ${currentProfile.gender === 'female' ? 'bg-white dark:bg-slate-700 shadow text-pink-500' : 'text-slate-400'}` }, "Mujer")
                                        )
                                    ),
                                    React.createElement("button", { onClick: () => setDarkMode(!darkMode), className: "w-full p-4 flex items-center justify-between hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors" }, React.createElement("span", { className: "font-medium text-slate-700 dark:text-white text-sm flex items-center gap-3" }, React.createElement(Moon, { size: 18, className: "text-slate-400" }), " Modo Oscuro"), React.createElement("div", { className: `w-10 h-6 rounded-full relative transition-colors ${darkMode ? theme.bg : 'bg-slate-200'}` }, React.createElement("div", { className: `absolute top-1 w-4 h-4 bg-white rounded-full transition-all ${darkMode ? 'left-5' : 'left-1'}` }))),
                                    React.createElement("button", { onClick: () => setShowResetConfirm(true), className: "w-full p-4 flex items-center justify-between hover:bg-rose-50 dark:hover:bg-rose-900/10 text-rose-500 transition-colors" }, React.createElement("span", { className: "font-medium text-sm flex items-center gap-3" }, React.createElement(Trash2, { size: 18, className: "text-rose-400" }), " Borrar datos de ", currentProfile.name)),
                                    React.createElement("button", { onClick: () => setIsAuth(false), className: "w-full p-4 bg-white dark:bg-slate-850 rounded-2xl flex items-center justify-between text-slate-500" }, React.createElement("span", { className: "font-medium text-sm flex items-center gap-3" }, React.createElement(LogOut, { size: 18 }), " Cerrar Sesi√≥n"))
                                )
                            )
                        ),
                        
                        // NAV (Bot√≥n '+' modificado)
                        React.createElement("nav", { className: "fixed bottom-0 w-full bg-white dark:bg-slate-850 border-t border-slate-100 dark:border-slate-800 pb-safe z-30 transition-colors duration-300" },
                            React.createElement("div", { className: "flex justify-around items-center p-2" },
                                ['home', 'stats', 'plus', 'goals', 'profile'].map(item => {
                                    if (item === 'plus') return React.createElement("div", { key: item, className: "relative -top-6" }, 
                                        // --- MODIFICADO ---
                                        React.createElement("button", { onClick: () => handleOpenNewTx('expense'), className: `${theme.bg} text-white p-4 rounded-full shadow-lg active:scale-95 transition-transform border-4 border-slate-50 dark:border-slate-900` }, React.createElement(Plus, { size: 28 }))
                                    );
                                    const Icon = item === 'home' ? LayoutGrid : item === 'stats' ? PieIcon : item === 'goals' ? Target : Settings;
                                    const label = item === 'home' ? 'Inicio' : item === 'stats' ? 'An√°lisis' : item === 'goals' ? 'Metas' : 'Perfil';
                                    return React.createElement("button", { key: item, onClick: () => setActiveTab(item), className: `flex flex-col items-center p-2 rounded-xl transition-colors ${activeTab === item ? `${theme.text} dark:text-white` : 'text-slate-400 dark:text-slate-600'}` }, React.createElement(Icon, { size: 24, strokeWidth: activeTab === item ? 2.5 : 2 }), React.createElement("span", { className: "text-[10px] font-bold mt-1" }, label));
                                })
                            )
                        ),

                        // --- MODAL DE REPORTES (Sin cambios) ---
                        showReportModal && React.createElement("div", { className: "fixed inset-0 z-50 bg-black/50 flex items-end sm:items-center justify-center fade-in" },
                            React.createElement("div", { className: "bg-white dark:bg-slate-850 w-full sm:max-w-md rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl border border-transparent dark:border-slate-800" },
                                React.createElement("div", { className: "flex justify-between items-center mb-6" }, 
                                    React.createElement("h3", { className: "font-bold text-lg text-slate-800 dark:text-white" }, "Generar Reporte"), 
                                    React.createElement("button", { onClick: () => setShowReportModal(false), className: "p-2 bg-slate-100 dark:bg-slate-800 rounded-full" }, React.createElement(X, { size: 20, className: "text-slate-600 dark:text-white" }))
                                ),
                                React.createElement("div", { className: "space-y-4" },
                                    React.createElement("div", { className: "flex gap-2 overflow-x-auto pb-2 scrollbar-hide" },
                                        [{k:'month', l:'Este Mes'}, {k:'prev_month', l:'Mes Pasado'}, {k:'all', l:'Todo'}, {k:'custom', l:'Rango'}].map(f => 
                                            React.createElement("button", { key: f.k, onClick: () => setReportFilter(f.k), className: `px-4 py-2 rounded-xl font-bold text-xs whitespace-nowrap transition-colors ${reportFilter === f.k ? 'bg-blue-600 text-white' : 'bg-slate-100 dark:bg-slate-800 text-slate-500'}` }, f.l)
                                        )
                                    ),
                                    reportFilter === 'custom' && React.createElement("div", { className: "flex gap-3" },
                                        React.createElement("div", { className: "flex-1" }, React.createElement("label", { className: "text-[10px] font-bold text-slate-400 uppercase ml-1" }, "Desde"), React.createElement("input", { type: "date", className: "w-full p-3 bg-slate-50 dark:bg-black rounded-xl text-xs font-bold dark:text-white border border-slate-200 dark:border-slate-800", value: customStart, onChange: e => setCustomStart(e.target.value) })),
                                        React.createElement("div", { className: "flex-1" }, React.createElement("label", { className: "text-[10px] font-bold text-slate-400 uppercase ml-1" }, "Hasta"), React.createElement("input", { type: "date", className: "w-full p-3 bg-slate-50 dark:bg-black rounded-xl text-xs font-bold dark:text-white border border-slate-200 dark:border-slate-800", value: customEnd, onChange: e => setCustomEnd(e.target.value) }))
                                    ),
                                    React.createElement("div", { className: "grid grid-cols-2 gap-3 pt-2" },
                                        React.createElement("button", { onClick: () => { generatePDF(getFilteredDataForReport(), currentProfile.name, reportFilter, categories); setShowReportModal(false); }, className: "flex items-center justify-center gap-2 p-4 bg-rose-500 text-white rounded-xl font-bold hover:bg-rose-600 transition-colors" }, React.createElement(FileText, { size: 20 }), "PDF"),
                                        React.createElement("button", { onClick: () => { generateExcel(getFilteredDataForReport(), currentProfile.name, reportFilter, categories); setShowReportModal(false); }, className: "flex items-center justify-center gap-2 p-4 bg-emerald-600 text-white rounded-xl font-bold hover:bg-emerald-700 transition-colors" }, React.createElement(FileSpreadsheet, { size: 20 }), "Excel")
                                    )
                                )
                            )
                        ),

                        // --- MODAL DE TRANSACCI√ìN (MODIFICADO) ---
                        showTransModal && React.createElement("div", { className: "fixed inset-0 z-50 bg-black/50 flex items-end sm:items-center justify-center fade-in" },
                            React.createElement("div", { className: "bg-white dark:bg-slate-850 w-full sm:max-w-md rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl border border-transparent dark:border-slate-800" },
                                // T√≠tulo din√°mico
                                React.createElement("div", { className: "flex justify-between items-center mb-6" }, 
                                    React.createElement("h3", { className: "font-bold text-lg text-slate-800 dark:text-white" }, editingTx ? "Editar Movimiento" : "Nuevo Movimiento"), 
                                    React.createElement("button", { onClick: () => { setShowTransModal(false); resetTransForm(); }, className: "p-2 bg-slate-100 dark:bg-slate-800 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700" }, React.createElement(X, { size: 20, className: "text-slate-600 dark:text-white" }))
                                ),
                                formError && React.createElement("div", { className: "mb-4 p-3 bg-rose-100 dark:bg-rose-900/30 border border-rose-200 dark:border-rose-800 rounded-xl flex items-center gap-3" }, React.createElement(Ban, { className: "text-rose-500 shrink-0", size: 20 }), React.createElement("span", { className: "text-xs font-bold text-rose-600 dark:text-rose-400" }, formError)),
                                React.createElement("div", { className: "space-y-5" },
                                    /* ... (Sin cambios: Toggle, Monto, Fecha, Categor√≠a, Nota) ... */
                                    React.createElement("div", { className: "flex bg-slate-100 dark:bg-slate-800 p-1 rounded-xl" },
                                        React.createElement("button", { onClick: () => { setTransForm({ ...transForm, type: 'income' }); setFormError(''); }, className: `flex-1 py-2 rounded-lg font-bold text-sm transition-colors ${transForm.type === 'income' ? 'bg-white dark:bg-slate-700 text-emerald-500 shadow-sm' : 'text-slate-400'}` }, "Ingreso"),
                                        React.createElement("button", { onClick: () => { setTransForm({ ...transForm, type: 'expense' }); setFormError(''); }, className: `flex-1 py-2 rounded-lg font-bold text-sm transition-colors ${transForm.type === 'expense' ? 'bg-white dark:bg-slate-700 text-rose-500 shadow-sm' : 'text-slate-400'}` }, "Gasto")
                                    ),
                                    React.createElement("div", { className: "relative" }, React.createElement("span", { className: `absolute top-1/2 -translate-y-1/2 left-4 text-2xl font-bold ${formError ? 'text-rose-300' : 'text-slate-300 dark:text-slate-600'}` }, "C$"), React.createElement("input", { type: "number", inputMode: "numeric", placeholder: "0", className: `w-full pl-12 pr-4 py-4 text-4xl font-bold text-center bg-slate-50 dark:bg-black rounded-2xl outline-none transition-colors ${formError ? 'text-rose-500 ring-2 ring-rose-500 bg-rose-50 dark:bg-rose-900/10' : 'text-slate-800 dark:text-white focus:ring-2 focus:ring-indigo-200 dark:focus:ring-slate-700'}`, value: transForm.amount, onChange: e => { setTransForm({ ...transForm, amount: e.target.value }); setFormError(''); } })),
                                    React.createElement("div", { className: "flex items-center gap-3 bg-slate-50 dark:bg-black p-3 rounded-2xl border border-slate-200 dark:border-slate-800" }, React.createElement(Clock, { size: 20, className: "text-slate-400" }), React.createElement("input", { type: "datetime-local", className: "bg-transparent outline-none w-full font-bold text-slate-700 dark:text-white text-sm", value: transForm.date, onChange: e => setTransForm({ ...transForm, date: e.target.value }) })),
                                    React.createElement("button", { onClick: () => setShowCatModal(true), className: "w-full p-4 bg-white dark:bg-black border border-slate-200 dark:border-slate-800 rounded-2xl flex justify-between items-center hover:border-indigo-300 transition-colors" }, transForm.categoryId ? React.createElement("div", { className: "flex items-center gap-3" }, (() => { const c = categories.find(x => x.id === transForm.categoryId); return c ? React.createElement(React.Fragment, null, React.createElement("div", { style: { color: c.color } }, React.createElement(IconRenderer, { name: c.icon, size: 24 })), React.createElement("span", { className: "font-bold text-slate-700 dark:text-white" }, c.name)) : 'Error'; })()) : React.createElement("span", { className: "text-slate-400 font-medium" }, "Seleccionar Categor√≠a"), React.createElement(ChevronRight, { size: 20, className: "text-slate-400" })),
                                    React.createElement("input", { placeholder: "Nota (Opcional)", className: "w-full p-4 bg-white dark:bg-black border border-slate-200 dark:border-slate-800 rounded-2xl outline-none text-slate-800 dark:text-white placeholder-slate-400 focus:border-indigo-400 transition-colors", value: transForm.desc, onChange: e => setTransForm({ ...transForm, desc: e.target.value }) }),
                                    
                                    // --- ¬°NUEVO GRUPO DE BOTONES! ---
                                    React.createElement("div", { className: "flex gap-3" },
                                        // Bot√≥n de borrar (solo aparece si estamos editando)
                                        editingTx && React.createElement("button", { onClick: handleDeleteTrans, className: "p-4 bg-slate-100 dark:bg-slate-800 text-rose-500 rounded-xl" },
                                            React.createElement(Trash2, { size: 24 })
                                        ),
                                        // Bot√≥n de Guardar/Actualizar
                                        React.createElement("button", { onClick: handleSaveTrans, className: `w-full py-4 rounded-xl text-white font-bold text-lg shadow-md active:scale-95 transition-transform ${transForm.type === 'income' ? 'bg-emerald-500' : 'bg-rose-500'}` }, 
                                            editingTx ? "Actualizar" : "Guardar"
                                        )
                                    )
                                )
                            )
                        ),
                        
                        /* ... (Resto de modales sin cambios) ... */
                        showCatModal && React.createElement("div", { className: "fixed inset-0 z-50 bg-black/50 flex items-end sm:items-center justify-center fade-in" },
                            React.createElement("div", { className: "bg-white dark:bg-slate-850 w-full sm:max-w-md rounded-t-3xl sm:rounded-3xl p-6 max-h-[80vh] overflow-y-auto shadow-2xl border border-transparent dark:border-slate-800" },
                                React.createElement("div", { className: "flex justify-between items-center mb-6" }, React.createElement("h3", { className: "font-bold text-lg text-slate-800 dark:text-white" }, "Elige Categor√≠a"), React.createElement("button", { onClick: () => setShowCatModal(false), className: "p-2 bg-slate-100 dark:bg-slate-800 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700" }, React.createElement(X, { size: 20, className: "text-slate-600 dark:text-white" }))),
                                React.createElement("div", { className: "grid grid-cols-3 gap-3" },
                                    categories.map(c => React.createElement("button", { key: c.id, onClick: () => { setTransForm({ ...transForm, categoryId: c.id }); setShowCatModal(false); }, className: "flex flex-col items-center gap-2 p-3 rounded-2xl border border-slate-100 dark:border-slate-800 hover:bg-indigo-50 dark:hover:bg-slate-800 transition-colors" }, React.createElement("div", { style: { color: c.color }, className: "bg-slate-50 dark:bg-slate-800 p-3 rounded-full" }, React.createElement(IconRenderer, { name: c.icon, size: 24 })), React.createElement("span", { className: "text-xs font-bold text-slate-600 dark:text-slate-300" }, c.name))),
                                    React.createElement("button", { onClick: () => { setShowCatModal(false); setShowCreateCat(true); }, className: "flex flex-col items-center gap-2 p-3 rounded-2xl border border-dashed border-slate-300 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800" }, React.createElement("div", { className: "bg-slate-100 dark:bg-slate-800 p-3 rounded-full text-slate-400" }, React.createElement(Plus, { size: 24 })), React.createElement("span", { className: "text-xs font-bold text-slate-400" }, "Nueva"))
                                )
                            )
                        ),
                        showCreateCat && React.createElement("div", { className: "fixed inset-0 z-50 bg-black/50 flex items-end sm:items-center justify-center fade-in" },
                            React.createElement("div", { className: "bg-white dark:bg-slate-850 w-full sm:max-w-md rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl border border-transparent dark:border-slate-800" },
                                React.createElement("h3", { className: "font-bold text-lg mb-4 text-slate-800 dark:text-white" }, "Crear Categor√≠a"),
                                React.createElement("div", { className: "space-y-4" },
                                    React.createElement("input", { placeholder: "Nombre", autoFocus: true, className: "w-full p-4 bg-slate-50 dark:bg-black rounded-xl border-none outline-none font-bold text-slate-800 dark:text-white placeholder-slate-400", value: catForm.name, onChange: e => setCatForm({ ...catForm, name: e.target.value }) }),
                                    React.createElement("div", { className: "flex gap-2 overflow-x-auto pb-2 scrollbar-hide" }, Object.keys(ICON_MAP).map(k => React.createElement("button", { key: k, onClick: () => setCatForm({ ...catForm, icon: k }), className: `p-3 rounded-xl shrink-0 transition-colors ${catForm.icon === k ? 'bg-indigo-600 text-white' : 'bg-slate-100 dark:bg-slate-800 text-slate-400'}` }, React.createElement(IconRenderer, { name: k })))),
                                    React.createElement("div", { className: "flex gap-3 overflow-x-auto pb-2 scrollbar-hide" }, ['#ef4444', '#f97316', '#f59e0b', '#10b981', '#3b82f6', '#6366f1', '#ec4899'].map(c => React.createElement("button", { key: c, onClick: () => setCatForm({ ...catForm, color: c }), style: { backgroundColor: c }, className: `w-10 h-10 rounded-full shrink-0 transition-transform ${catForm.color === c ? 'scale-110 ring-2 ring-slate-400' : ''}` }))),
                                    React.createElement("div", { className: "flex gap-2 pt-2" },
                                        React.createElement("button", { onClick: () => setShowCreateCat(false), className: "flex-1 py-3 rounded-xl font-bold text-slate-500 bg-slate-100 dark:bg-slate-800" }, "Cancelar"),
                                        React.createElement("button", { onClick: () => { if (catForm.name) { setCategories([...categories, { id: `c-${Date.now()}`, ...catForm }]); setShowCreateCat(false); setShowCatModal(true); } }, className: "flex-1 py-3 rounded-xl font-bold text-white bg-indigo-500 shadow-md" }, "Crear")
                                    )
                                )
                            )
                        ),
                        showGoalModal && React.createElement("div", { className: "fixed inset-0 z-50 bg-black/50 flex items-end sm:items-center justify-center fade-in" },
                            React.createElement("div", { className: "bg-white dark:bg-slate-850 w-full sm:max-w-md rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl border border-transparent dark:border-slate-800" },
                                React.createElement("h3", { className: "font-bold text-lg mb-4 text-slate-800 dark:text-white" }, "Nueva Meta"),
                                React.createElement("div", { className: "space-y-4" },
                                    React.createElement("input", { placeholder: "Nombre (ej. Moto)", className: "w-full p-4 bg-slate-50 dark:bg-black rounded-xl border-none outline-none font-bold text-slate-800 dark:text-white placeholder-slate-400", value: goalForm.name, onChange: e => setGoalForm({ ...goalForm, name: e.target.value }) }),
                                    React.createElement("div", { className: "relative" }, React.createElement("span", { className: "absolute top-1/2 -translate-y-1/2 left-4 font-bold text-slate-400" }, "C$"), React.createElement("input", { type: "number", placeholder: "Objetivo", className: "w-full pl-10 p-4 bg-slate-50 dark:bg-black rounded-xl border-none outline-none font-bold text-slate-800 dark:text-white placeholder-slate-400", value: goalForm.target, onChange: e => setGoalForm({ ...goalForm, target: e.target.value }) })),
                                    React.createElement("div", { className: "flex gap-2 pt-2" },
                                        React.createElement("button", { onClick: () => setShowGoalModal(false), className: "flex-1 py-3 rounded-xl font-bold text-slate-500 bg-slate-100 dark:bg-slate-800" }, "Cancelar"),
                                        React.createElement("button", { onClick: () => { if(goalForm.name && goalForm.target > 0) { setGoals([...goals, { id: Date.now(), walletMode, name: goalForm.name, target: Number(goalForm.target), current: 0, color: categories[Math.floor(Math.random()*categories.length)].color }]); setShowGoalModal(false); setGoalForm({name:'', target:''}); } }, className: `flex-1 py-3 rounded-xl font-bold text-white shadow-md ${theme.bg}` }, "Guardar")
                                    )
                                )
                            )
                        ),
                        showNameEdit && React.createElement("div", { className: "fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4 fade-in" },
                            React.createElement("div", { className: "bg-white dark:bg-slate-850 w-full max-w-xs rounded-3xl p-6 shadow-2xl border border-transparent dark:border-slate-800" },
                                React.createElement("h3", { className: "font-bold text-center mb-4 text-slate-800 dark:text-white" }, "Cambiar Nombre"),
                                React.createElement("input", { className: "w-full p-3 bg-slate-100 dark:bg-slate-800 rounded-xl text-center font-bold mb-4 text-slate-800 dark:text-white outline-none focus:ring-2 focus:ring-blue-400 placeholder-slate-400", value: tempName, onChange: e => setTempName(e.target.value), placeholder: "Tu nombre" }),
                                React.createElement("div", { className: "flex gap-2" },
                                    React.createElement("button", { onClick: () => setShowNameEdit(false), className: "flex-1 py-2 rounded-xl font-bold text-slate-500 bg-slate-100 dark:bg-slate-800" }, "Cancelar"),
                                    React.createElement("button", { onClick: () => { if(tempName.trim()) { updateProfile({ name: tempName }); setShowNameEdit(false); } }, className: "flex-1 py-2 rounded-xl font-bold text-white bg-blue-500" }, "Guardar")
                                )
                            )
                        ),
                        showResetConfirm && React.createElement("div", { className: "fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4 fade-in" },
                            React.createElement("div", { className: "bg-white dark:bg-slate-850 w-full max-w-xs rounded-3xl p-6 shadow-2xl border border-rose-100 dark:border-rose-900/30" },
                                React.createElement("div", { className: "flex justify-center mb-4 text-rose-500" }, React.createElement(AlertTriangle, { size: 40 })),
                                React.createElement("h3", { className: "font-bold text-center mb-2 text-slate-800 dark:text-white" }, "¬øBorrar ", currentProfile.name, "?"),
                                React.createElement("p", { className: "text-center text-xs text-slate-400 mb-4" }, "Solo se borrar√°n transacciones y metas de este perfil."),
                                React.createElement("div", { className: "flex gap-2" },
                                    React.createElement("button", { onClick: () => setShowResetConfirm(false), className: "flex-1 py-2 rounded-xl font-bold text-slate-500 bg-slate-100 dark:bg-slate-800" }, "No"),
                                    React.createElement("button", { onClick: handleResetProfileData, className: "flex-1 py-2 rounded-xl font-bold text-white bg-rose-500" }, "S√≠, Borrar")
                                )
                            )
                        )
                    )
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>

